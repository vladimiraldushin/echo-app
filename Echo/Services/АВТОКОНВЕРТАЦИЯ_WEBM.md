# ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è WebM –¥–æ–±–∞–≤–ª–µ–Ω–∞!

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å **–Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å** WebM —Ñ–∞–π–ª—ã!

---

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback:

```
1. –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å WebM —á–µ—Ä–µ–∑ AVFoundation
   ‚Üì (–µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å)
   
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ afconvert (–≤—Å—Ç—Ä–æ–µ–Ω –≤ macOS!)
   WebM ‚Üí M4A (AAC, 192kbps)
   ‚Üì
   
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ M4A ‚Üí CAF ‚Üí Float[] –º–∞—Å—Å–∏–≤
   ‚Üì
   
4. –ì–æ—Ç–æ–≤–æ! ‚úÖ
```

---

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

- ‚úÖ **–ù–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** ‚Äî `afconvert` –≤—Å—Ç—Ä–æ–µ–Ω –≤ macOS
- ‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç offline** ‚Äî –Ω–µ –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- ‚úÖ **–ë—ã—Å—Ç—Ä–æ** ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω–µ

---

## üéØ –ß—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:

### –†–∞–Ω—å—à–µ (‚ùå):
```
–ó–∞–≥—Ä—É–∑–∫–∞ WebM —Ñ–∞–π–ª–∞...
‚ùå –û—à–∏–±–∫–∞: WebM —Ñ–∞–π–ª –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
   –°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ QuickTime...
```

### –¢–µ–ø–µ—Ä—å (‚úÖ):
```
–ó–∞–≥—Ä—É–∑–∫–∞ WebM —Ñ–∞–π–ª–∞...
‚ùå AVFoundation failed, trying afconvert...
üîÑ Auto-converting via afconvert...
‚úÖ Converted! Processing...
üìä –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –Ω–∞—á–∞–ª–∞—Å—å!
```

---

## üìã –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

### `AudioConverter.swift`:

```swift
private func convertViaAFConvert(url: URL) async throws -> [Float] {
    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º WebM ‚Üí M4A —á–µ—Ä–µ–∑ afconvert
    let process = Process()
    process.executableURL = URL(fileURLWithPath: "/usr/bin/afconvert")
    process.arguments = [
        "-f", "m4af",   // M4A —Ñ–æ—Ä–º–∞—Ç
        "-d", "aac",    // AAC –∫–æ–¥–µ–∫  
        "-b", "192000", // 192 kbps
        url.path, 
        tempM4A.path
    ]
    
    try process.run()
    process.waitUntilExit()
    
    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    ...
}
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### afconvert ‚Äî —á—Ç–æ —ç—Ç–æ?

**Audio File Convert** ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ macOS –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∞—É–¥–∏–æ.

–ù–∞—Ö–æ–¥–∏—Ç—Å—è –≤: `/usr/bin/afconvert`

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω–∏–º–∞–µ—Ç macOS, –≤–∫–ª—é—á–∞—è:
- WebM (Opus, Vorbis)
- MP3, WAV, FLAC, OGG
- MP4, MOV, –∏ —Ç.–¥.

### –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

`afconvert` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **CoreAudio** (–±–æ–ª–µ–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API —á–µ–º AVFoundation), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–µ –∫–æ–¥–µ–∫–æ–≤.

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
1. Cmd + B  (—Å–æ–±—Ä–∞—Ç—å)
2. Cmd + R  (–∑–∞–ø—É—Å—Ç–∏—Ç—å)  
3. –û—Ç–∫—Ä—ã—Ç—å –≤–∞—à WebM —Ñ–∞–π–ª
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è!
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è **47-–º–∏–Ω—É—Ç–Ω–æ–≥–æ –≤–∏–¥–µ–æ** (~500 MB):
- –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è WebM ‚Üí M4A: **~1-2 –º–∏–Ω—É—Ç—ã**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ M4A ‚Üí Float[]: **~10-20 —Å–µ–∫—É–Ω–¥**
- **–ò—Ç–æ–≥–æ: ~2-3 –º–∏–Ω—É—Ç—ã** –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏

**–ü—Ä–∏–µ–º–ª–µ–º–æ!** ‚úÖ

---

## üéì –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

–ï—Å–ª–∏ `afconvert` –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ), –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É ffmpeg:

```swift
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è ffmpeg
if FileManager.default.fileExists(atPath: "/usr/local/bin/ffmpeg") {
    return try await convertViaFFmpeg(url: url)
}
```

–ù–æ –¥–ª—è 99% —Å–ª—É—á–∞–µ–≤ `afconvert` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

**–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –ª—é–±—ã–µ WebM —Ñ–∞–π–ª—ã ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!** üöÄ

–ù–∏–∫–∞–∫–∏—Ö —Ç–∞–Ω—Ü–µ–≤ —Å –±—É–±–Ω–æ–º! üéâ
