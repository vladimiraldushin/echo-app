# ✅ WebM файлы теперь обрабатываются автоматически!

## 🎯 Что изменилось:

### Раньше:
- AVFoundation пытался обработать WebM
- Падал с ошибкой
- Только потом пробовал afconvert

### Теперь:
- **Проактивная проверка**: если файл `.webm` — сразу идёт на конвертацию
- **Двойная защита**: сначала `afconvert` (встроен в macOS), потом `ffmpeg` (если установлен)
- **Никакой мудни** — просто открываете файл, всё работает автоматически

---

## 🔧 Технические детали:

### 1. Проверка расширения файла
```swift
if url.pathExtension.lowercased() == "webm" {
    print("🎬 WebM detected → auto-converting...")
    return try await convertViaAFConvert(url: url)
}
```

### 2. Конвертация через afconvert
```swift
/usr/bin/afconvert -f m4af -d aac -b 192000 input.webm output.m4a
```

### 3. Fallback на ffmpeg (если afconvert не справился)
```swift
ffmpeg -i input.webm -vn -ar 16000 -ac 1 -f wav output.wav
```

Пути поиска ffmpeg:
- `/opt/homebrew/bin/ffmpeg` (Apple Silicon)
- `/usr/local/bin/ffmpeg` (Intel Mac)
- `/usr/bin/ffmpeg` (системный)

---

## 📦 Что поддерживается:

### Встроенная поддержка (через afconvert):
- ✅ WebM → M4A → обработка

### Расширенная поддержка (если установлен ffmpeg):
- ✅ WebM → WAV → обработка
- ✅ Любые экзотические форматы

---

## 🚀 Как использовать:

1. **Просто откройте WebM файл** в приложении
2. Конвертация произойдёт **автоматически**
3. Никаких дополнительных действий не требуется!

---

## 🛠️ Установка ffmpeg (опционально):

Если `afconvert` не справляется с вашими WebM файлами, установите ffmpeg:

```bash
brew install ffmpeg
```

После этого приложение автоматически будет использовать ffmpeg как fallback.

---

## 📊 Процесс конвертации:

```
WebM файл
    ↓
Проверка расширения (.webm)
    ↓
┌──────────────────────┐
│  Попытка 1: afconvert │
│  WebM → M4A → CAF    │
└──────────────────────┘
    ↓ (если ошибка)
┌──────────────────────┐
│  Попытка 2: ffmpeg   │
│  WebM → WAV          │
└──────────────────────┘
    ↓
Извлечение audio samples (16kHz mono Float32)
    ↓
✅ Готово!
```

---

## 🎉 Готово!

Теперь вы можете открывать любые WebM файлы без всякой мудни — аудиодорожка извлекается автоматически! 🚀
